!function($,e,t,i){"use strict";var l=e.View.extend({className:"pp-form-buider-settings-popup-container",iconPickerTemplate:t.template("pp-form-builder-material-icon"),events:{"click .pp-form-cancel-btn":"cancel_settings","click .pp-form-buider-settings-popup-tab-menu":"switch_tab","click .pp-form-save-btn":"save_changes","click .pp-form-control-icon-picker":"icon_picker","keyup input[name=label].pp-form-control":"make_label_placeholder"},initialize(e){if(void 0===e.fieldType)throw new Error("Field Type required");this.options=e,_.bindAll(this,"switch_tab"),_.bindAll(this,"save_changes"),_.bindAll(this,"icon_picker")},icon_picker(e){e.preventDefault();const t=this,i=$(e.target);(t.jboxInstance=new jBox("Modal",{title:$("#pp-form-material-icon-picker-tmpl-title").html(),maxWidth:600,zIndex:999999999,addClass:"pp-icon-picker-jbox-wrap",overlayClass:"pp-icon-picker-jbox-overlay",animation:"zoomIn",content:$("#pp-form-material-icon-picker-tmpl"),onOpen:function(){let e=$("input.pp-form-control",i.parent()),l=e.val();const a=$("#pp-form-material-icon-picker-tmpl");a.find(".pp-form-material-icon-wrap").removeClass("pp-active"),""!==l&&a.find('.pp-form-material-icon-wrap[data-material-icon="'+l+'"]').addClass("pp-active"),$(".pp-form-material-icon-wrap").on("click",(function(){let l=$(this).data("material-icon");i.html(t.iconPickerTemplate({icon:l})),e.val(l),t.jboxInstance.close()}))}})).open()},save_changes(e){e.preventDefault();let t=this;$(".pp-form-control").each((function(){let e=$(this).attr("name"),i=$(this).val();"checkbox"===$(this).attr("type")&&(i=this.checked),void 0!==e&&t.options.model.set(e,i)})),$("#label",this.$el).length>0?t.options.model.set("fieldBarTitle",$("#label",this.$el).val()):t.options.model.set("fieldBarTitle",$("#placeholder",this.$el).val()),t.remove()},switch_tab(e){e.preventDefault(),$(".pp-form-buider-settings-popup-tab-menu",this.$el).removeClass("active"),$(e.target).addClass("active"),$(".pp-form-buider-settings-popup-tab-content",this.$el).hide(),$($(e.target).attr("href")).show()},make_label_placeholder(e){e.preventDefault();var t=$("input[name=placeholder]",this.$el);!0!==this.$el.data("make_label_placeholder_flag")&&this.$el.data("make_label_placeholder_flag",""===t.val()),!0===this.$el.data("make_label_placeholder_flag")&&t.val($(e.target).val())},cancel_settings_outside(e){e.target==this.el&&this.remove()},cancel_settings(e){e.preventDefault(),this.remove()},render(){let e=-1!==this.options.fieldType.indexOf("reg-cpf")?"reg-cpf":this.options.fieldType;e=-1!==e.indexOf("edit-profile-cpf")?"edit-profile-cpf":e;let i=this.options.model.get("definedFieldType");void 0!==i&&(e=e+"-"+i);const l=t.template("pp-form-builder-popup-settings-"+e);this.$el.html(l(this.options.model.toJSON())),$(".pp-form-buider-settings-popup-tab-menu",this.$el).eq(0).addClass("active"),$(".pp-form-buider-settings-popup-tab-content",this.$el).hide().eq(0).show()}}),a=e.View.extend({className:"pp-builder-element",template:t.template("pp-form-builder-field-bar"),events:{"click .pp-builder-element-expand-button.pp-settings":"reveal_settings","click .pp-builder-element-expand-button.pp-delete":"delete_field","click .pp-builder-element-expand-button.pp-clone":"clone_field"},reveal_settings(e){e.preventDefault(),$(e.target).parent("a").trigger("blur");const t=this.model.get("fieldType");let i=new l({fieldType:t,model:this.model});i.render(),$("body").append(i.$el);var a=$(".pp-form-control-wpeditor");a.length>0&&a.each((function(){var e=$(this).attr("id");$("#"+e).pp_wp_editor({mode:"tmce"}),tinymce.get(e).on("keyup change undo redo SetContent",(function(){this.save()}))}))},delete_field(e){e.preventDefault(),confirm(pp_form_builder.confirm_delete)&&($(e.target).parent("a").trigger("blur"),this.remove(),this.collection.remove(this.model))},clone_field(e){e.preventDefault(),$(e.target).parent("a").trigger("blur"),this.collection.add(this.model.clone(),{at:this.collection.indexOf(this.model)})},render(){const e=this.model.get("fieldType"),t=void 0!==pp_form_builder_combined_fields[e]&&"undefined"!==pp_form_builder_combined_fields[e].fieldTitle?pp_form_builder_combined_fields[e].fieldTitle:this.model.get("fieldTitle");this.$el.html(this.template({fieldType:e,fieldTitle:t,fieldIcon:this.model.get("fieldIcon"),fieldBarTitle:this.model.get("fieldBarTitle")})).data("modelCID",this.model.cid)}}),d={addField(e,t,i,l){let a=i.findWhere({fieldType:"footer"}),d="pp_form_builder_"+t+"_fields";l=void 0!==l?l:i.indexOf(a);const p=_.extend(window[d][e],{fieldType:e});i.add(p,{at:l,sort:!1})},save_changes(e){$("#pp-form-builder-fields-settings").val(JSON.stringify(e.toJSON())),$(".pp_edit_form form").trigger("submit")}},p=e.View.extend({el:"#pp-form-builder",initialize(){_.bindAll(this,"update_sort_index"),_.bindAll(this,"addFieldOnDrop"),this.listenTo(this.collection,"add",this.render),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"pp_fieldBarTitle_changed",this.render)},initSortable(){this.$el.sortable({items:".pp-builder-element",cursor:"move",placeholder:"pp-form-builder-drag-bg",update:this.update_sort_index,receive:this.addFieldOnDrop})},addFieldOnDrop(e,t){let i,l;0===t.helper.prev().length||void 0===t.helper.prev().data("modelCID")?i=0:(l=t.helper.prev().data("modelCID"),i=this.collection.get(l).get("sortID"));let a=t.helper.find("a").data("field-type"),p=t.helper.find("a").data("field-category");d.addField(a,p,this.collection,i),this.update_sort_index(),t.helper.remove()},update_sort_index(){let e=this.collection;$(".pp-builder-form-content .pp-builder-element").each((function(t){t++;let i=$(this).data("modelCID");e.get(i).set("sortID",t)})),e.sort()},render(){let e=this.collection,t=[];e.each((function(i){const l=new a({model:i,collection:e});l.render(),t.push(l.el)})),this.$el.find(".pp-form-builder-body .pp-builder-form-content").html(t),this.initSortable()}}),o=e.View.extend({el:"#pp-form-builder-metabox",events:{"click .pp_upload_button":"media_upload"},initialize(){new jBox("Tooltip",{attach:".pp-form-builder-help-tip",maxWidth:200,theme:"TooltipDark"}),$(".form-field .wp-picker-container",this.$el).parent(".pp-field-row-content").css("width","auto")},media_upload(e){e.preventDefault();let t,i=$(e.target);t||(t=wp.media.frames.file_frame=wp.media({frame:"select",multiple:!1,library:{type:"image"}}),t.on("select",(function(){let e=t.state().get("selection").first().toJSON();i.parents(".pp_upload_field_container").find(".pp_upload_field").val(e.url)}))),t.open()}}),r=e.View.extend({el:".pp-form-builder-sidebar-wrap",template:t.template("pp-form-builder-sidebar-fields-block"),events:{"click .pp-draggable-field":"add_field","click .pp-form-save-changes":"save_changes"},initialize(){this.listenTo(this.collection,"add",this.disable_active_standard_fields),this.listenTo(this.collection,"remove",this.enable_inactive_standard_fields)},initDraggable(){this.$el.find(".pp-draggable-field").draggable({connectToSortable:"#pp-form-builder",helper:"clone",revert:"invalid",delay:10,appendTo:"body",cursorAt:{top:-5,left:-10}})},add_field(e){if(e.preventDefault(),$(e.target).parent(".pp-draggable-field").hasClass("ui-draggable-disabled"))return!1;let t=$(e.target).data("field-type"),i=$(e.target).data("field-category");d.addField(t,i,this.collection)},save_changes(e){e.preventDefault(),d.save_changes(this.collection)},disable_active_standard_fields(){this.collection.each((function(e){const t=e.get("fieldType");i.contains(pp_form_builder_fields_multiple_addition,t)||($('[data-field-type="'+t+'"]',"#pp-form-builder-standard-fields").attr("disabled","disabled").parent(".pp-draggable-field").draggable("disable"),$('[data-field-type="'+t+'"]',"#pp-form-builder-defined-fields").attr("disabled","disabled").parent(".pp-draggable-field").draggable("disable"))}))},enable_inactive_standard_fields(e){const t=e.get("fieldType");i.contains(pp_form_builder_fields_multiple_addition,t)||($('[data-field-type="'+t+'"]',"#pp-form-builder-standard-fields").removeAttr("disabled","disabled").parent(".pp-draggable-field").draggable("enable"),$('[data-field-type="'+t+'"]',"#pp-form-builder-defined-fields").removeAttr("disabled","disabled").parent(".pp-draggable-field").draggable("enable"))},render(){let e=[this.template({fieldsBlockType:"standard",fields:pp_form_builder_standard_fields})];!1===i.isEmpty(pp_form_builder_defined_fields)&&e.push(this.template({fieldsBlockType:"defined",fields:pp_form_builder_defined_fields})),!1===i.isEmpty(pp_form_builder_wc_billing_fields)&&e.push(this.template({fieldsBlockType:"wc_billing",fields:pp_form_builder_wc_billing_fields})),!1===i.isEmpty(pp_form_builder_wc_shipping_fields)&&e.push(this.template({fieldsBlockType:"wc_shipping",fields:pp_form_builder_wc_shipping_fields})),this.$el.find("#pp-form-builder-sidebar-fields-block").html(e),this.initDraggable(),this.disable_active_standard_fields()}}),n=e.Model.extend({initialize(){this.on("change:fieldBarTitle",(function(e,t){this.trigger("pp_fieldBarTitle_changed")}))}}),s=e.Collection.extend({model:n});let c={titleShit(){$("#title").each((function(){let e=$(this),t=$("#"+this.id+"-prompt-text");""===this.value&&t.removeClass("screen-reader-text"),t.on("click",(function(){$(this).addClass("screen-reader-text"),e.trigger("focus")})),e.on("blur",(function(){""===this.value&&t.removeClass("screen-reader-text")})),e.on("focus",(function(){t.addClass("screen-reader-text")}))}))},metabox_handle_shit(){$(document).on("click",".pp-metabox-handle",(function(e){e.preventDefault();let t=$(this),i=$(".pp-metabox-handle"),l=$(this).parents(".pp-postbox-wrap");i.parents(".pp-postbox-wrap").find(".postbox-header").removeClass("postbox").removeClass("closed"),i.not(t).parents(".pp-postbox-wrap").addClass("closed"),l.hasClass("closed")?l.removeClass("closed"):l.addClass("closed")})),$("#pp-form-builder-standard-fields .pp-metabox-handle").trigger("click")},init(){if("undefined"==typeof pp_form_builder_fields_settings)return;let e=new s(pp_form_builder_fields_settings);window.ppFormSettings=e,e.comparator="sortID";new p({collection:e}).render();new r({collection:e}).render(),$(document).on("click",".pp-form-save-changes",(function(e){e.preventDefault(),d.save_changes(window.ppFormSettings)})),new o},tabify(){let e=$("ul.pp-tabs li a","#pp-form-builder-metabox");e.length>0&&e.on("click",(function(e){e.preventDefault(),$(".pp-form-builder_options_panel").hide(),$("#pp-form-builder-metabox ul.pp-tabs li").removeClass("active"),$(this).parent().addClass("active"),$($(this).attr("href")).show()})).eq(0).trigger("click")}};$((function(){c.tabify();let e=$(".pp-dnd-form-builder-wrap");0!==e.length&&(c.init(),c.titleShit(),c.metabox_handle_shit(),setTimeout((function(){e.css("opacity","1")}),500))}))}(jQuery,Backbone,wp,_);