(()=>{function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function a(e){for(var a=1;a<arguments.length;a++){var r=null!=arguments[a]?arguments[a]:{};a%2?t(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(t,a,s){return(a=function(t){var a=function(t){if("object"!=e(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=e(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(a)?a:a+""}(a))in t?Object.defineProperty(t,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[a]=s,t}function r(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new URLSearchParams(window.location.search),a=t.get("template"),s=t.get("nonce"),o=0,n=0;e?(o=1,h(),n=6,a.includes("astra")?n=parseInt(n)+35:a.includes("kadence")&&(n=parseInt(n)+9),Cookies.set("ldDwTotalSteps",n)):(o=Cookies.get("ldDwCurrentStepN"),o=parseInt(o)+1,n=Cookies.get("ldDwTotalSteps")),Cookies.set("ldDwCurrentStepN",o),jQuery.post(LearnDashDesignWizard.ajaxurl,{action:"ld_dw_build_template",nonce:s,template:a,init:e},(function(e){if(e.success){if(e.data.complete){o=1,n=1,h(!0);var t=LearnDashDesignWizard.templates.actions_success;jQuery(".design-wizard > .content > .text").replaceWith(t)}else"build_template"!==e.data.step?r():"build_template"===e.data.step&&("astra"===e.data.theme?i():"kadence"===e.data.theme&&l());d({currentStepN:o,totalSteps:n,message:e.data.message})}}))}function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",n=new URLSearchParams(window.location.search),l=Cookies.get("ldDwFont"),u=Cookies.get("ldDwPalette"),m=JSON.stringify(c("astra",l)),h=Cookies.get("astra-site-color-scheme"),g=n.get("step");h&&(e=JSON.stringify(p("astra",u,h))),t.length<1&&(t=LearnDashDesignWizard.ajaxurl);var w,_=["astra-sites-api-request","astra-required-plugins","astra-sites-filesystem-permission","astra-sites-set-start-flag","astra-sites-reset-customizer-data","astra-sites-reset-site-options","astra-sites-reset-widgets-data","astra-sites-reset-terms-and-forms","astra-sites-get-deleted-post-ids","astra-sites-reset-posts","astra-sites-import-wpforms","astra-sites-import-cartflows","astra-sites-import-customizer-settings","astra-sites-import-prepare-xml","astra-wxr-import","astra-sites-import-options","astra-sites-import-widgets","astra_sites_set_site_data-site_colors","astra_sites_set_site_data-site_typography","astra-sites-import-end"],k=Cookies.get("ldDwThemeTemplateId"),D=Cookies.get("ldDwLastBuildAstraStep"),y=Cookies.get("ldDwTotalSteps"),v=Cookies.get("ldDwCurrentStepN"),C="";v=parseInt(v)+1,Cookies.set("ldDwCurrentStepN",v),w=D?_.indexOf(D)+1:0;var j=_[w];if(j){var b,S,L;switch(g=j,j){case"astra-sites-api-request":s.url="astra-sites/"+k,C="Get template data";break;case"astra-sites-reset-customizer-data":C="Reset site data";break;case"astra-sites-reset-posts":S="undefined"!==(b=Cookies.get("astra-site-deleted-post-ids"))?(b=b.split(",")).splice(0,10):[],s.ids=Object.assign({},S),s.ids=JSON.stringify(s.ids),L="undefined"!==b&&b.length>0;break;case"astra-sites-import-wpforms":s.wpforms_url=Cookies.get("astra-site-wpforms-path"),Cookies.remove("astra-site-wpforms-path"),C="Import wpforms data if any";break;case"astra-sites-import-cartflows":s.cartflows_url=Cookies.get("astra-site-cartflows-path"),Cookies.remove("astra-site-cartflows-path"),C="Import cartflows data if any";break;case"astra-sites-import-widgets":s.widgets_data=Cookies.get("astra-site-widgets-data"),Cookies.remove("astra-site-widgets-data"),C="Import widgets data";break;case"astra-sites-import-prepare-xml":s.wxr_url=Cookies.get("astra-site-wxr-path"),Cookies.remove("astra-site-wxr-path"),C="Import XML data";break;case"astra_sites_set_site_data-site_colors":g="astra_sites_set_site_data",s.param="site-colors",s.palette=e,s.security=LearnDashDesignWizard.ajax_set_data_nonce,Cookies.remove("astra-site-color-scheme"),C="Apply site color options";break;case"astra_sites_set_site_data-site_typography":g="astra_sites_set_site_data",s.param="site-typography",s.typography=m,s.security=LearnDashDesignWizard.ajax_set_data_nonce,C="Apply site typography options"}d({currentStepN:v,totalSteps:y,message:C}),jQuery.ajax({url:t,type:o,data:a({action:g,_ajax_nonce:LearnDashDesignWizard.ajax_nonce},s),success:function(e){if("astra-wxr-import"===j)e.length>0&&i();else if("astra-wxr-import"!==j)if(e.success){var t,a="",s="POST";switch(j){case"astra-sites-api-request":Cookies.set("astra-site-wpforms-path",e.data["astra-site-wpforms-path"]),Cookies.set("astra-site-cartflows-path",e.data["astra-site-cartflows-path"]),Cookies.set("astra-site-wxr-path",e.data["astra-site-wxr-path"]),Cookies.set("astra-site-widgets-data",e.data["astra-site-widgets-data"]);break;case"astra-required-plugins":Cookies.set("astra-site-required-plugins",e.data.required_plugins),e.data.required_plugins.notinstalled.forEach((function(e){wp.updates.queue.push({action:"install-plugin",data:{slug:e.slug,init:e.init,name:e.name,clear_destination:!0,success:function(){f(e)},error:function(){}}})})),wp.updates.queueChecker(),e.data.required_plugins.inactive.forEach((function(e){f(e)}));break;case"astra-sites-get-deleted-post-ids":t=e.data.splice(0,100),Cookies.set("astra-site-deleted-post-ids",t);break;case"astra-sites-import-prepare-xml":a=e.data.url,s="GET";break;case"astra-sites-import-end":return Cookies.remove("ldDwLastBuildAstraStep"),void r()}i(a,{},s)}else{C=Object.hasOwnProperty.call(e,"data")&&Object.hasOwnProperty.call(e.data,"message")?e.data.message:LearnDashDesignWizard.messages.dw_error_default,C=LearnDashDesignWizard.messages.dw_error_prefix+": "+C,d({currentStepN:v-1,totalSteps:y,message:C});var o=LearnDashDesignWizard.templates.actions_error;jQuery(".design-wizard > .content > .text").replaceWith(o),Cookies.remove("ldDwLastBuildAstraStep")}v=parseInt(v)+1,Cookies.set("ldDwCurrentStepN",v)}}).fail((function(){Cookies.remove("ldDwLastBuildAstraStep"),Cookies.remove("ldDwCurrentStepN")})),L?Cookies.set("ldDwLastBuildAstraStep","astra-sites-reset-terms-and-forms"):Cookies.set("ldDwLastBuildAstraStep",j)}else Cookies.remove("ldDwLastBuildAstraStep")}jQuery(window).on("load",(function(){!function(){var e=new URLSearchParams(window.location.search),t=e.get("template"),a=e.get("nonce"),s=e.get("step"),i="";if(s=s?parseInt(s):1,t&&(i=t.includes("kadence_")?"kadence":"astra"),1===s)Cookies.remove("ldDwTemplateId"),jQuery("#ld_dw_initial_confirm").dialog({dialogClass:"wp-dialog ld_dw_initial_confirm",modal:!0,title:LearnDashDesignWizard.confirm_dialog.start_title,width:400,closeOnEscape:!1,buttons:[{text:LearnDashDesignWizard.confirm_dialog.proceed,click:function(){jQuery("#ld_dw_initial_confirm").dialog("close")}},{text:LearnDashDesignWizard.confirm_dialog.exit,click:function(){window.location.href=LearnDashDesignWizard.learndash_setup_url}}]});else if(2===s||3===s||4===s){var o=Cookies.get("ldDwFont"),n=Cookies.get("ldDwPalette");setTimeout((function(){m(i,"site-colors",n),m(i,"site-typography",o),setTimeout((function(){jQuery("#ld-site-preview").show()}),1e3)}),500)}else 5===s&&t.length>0&&a.length>0&&(Cookies.remove("ldDwLastBuildAstraStep"),Cookies.remove("ldDwLastBuildKadenceStep"),r(!0))}()})),jQuery((function(){jQuery(document).on("mouseover",".templates .template figure",(function(e){e.preventDefault(),jQuery(this).addClass("hover")})),jQuery(document).on("mouseleave",".templates .template figure",(function(e){e.preventDefault(),jQuery(this).removeClass("hover")})),jQuery(document).on("click",".templates .template figure .actions .select",(function(e){e.preventDefault();var t=jQuery(this).closest(".templates"),a=jQuery(this).closest(".template").data("id"),s=jQuery(this).closest(".template").data("theme_template_id");t.find(".template").removeClass("selected"),jQuery(this).closest(".template").addClass("selected"),Cookies.set("ldDwTemplateId",a),Cookies.set("ldDwThemeTemplateId",s),Cookies.set("ldDwPalette","default"),Cookies.set("ldDwFont","default")})),jQuery(document).on("click",".templates .template figure .actions .preview",(function(e){e.preventDefault();var t=jQuery(".preview-wrapper"),a=t.find(".iframe-wrapper"),s=jQuery(this).closest(".template"),r=s.data("id").includes("kadence_")?"kadence":"astra",i=s.data("preview_url");i&&i.length>0&&(t.find("iframe").attr("src",i),t.show(),a.hide(),setTimeout((function(){m(r,"site-colors","default"),m(r,"site-typography","default"),a.show()}),500))})),jQuery(document).on("click",".preview-wrapper .close",(function(e){e.preventDefault();var t=jQuery(this).closest(".preview-wrapper");t.find(".preview iframe").removeAttr("src"),t.hide()})),jQuery(document).on("click",".design-wizard .fonts .font",(function(e){e.preventDefault();var t=jQuery(this).closest(".fonts"),a=jQuery(this).data("id"),s=Cookies.get("ldDwTemplateId").includes("kadence_")?"kadence":"astra";t.find(".font").removeClass("selected"),jQuery(this).addClass("selected"),Cookies.set("ldDwFont",a),m(s,"site-typography",a)})),jQuery(document).on("click",".design-wizard .reset-font-button",(function(e){e.preventDefault();var t=jQuery(this).closest(".header").find(".fonts"),a=Cookies.get("ldDwTemplateId").includes("kadence_")?"kadence":"astra";t.find(".font").removeClass("selected"),Cookies.remove("ldDwFont"),m(a,"site-typography","default")})),jQuery(document).on("click",".design-wizard .palettes .palette",(function(e){e.preventDefault();var t=jQuery(this).closest(".palettes"),a=jQuery(this).data("id"),s=Cookies.get("ldDwTemplateId").includes("kadence_")?"kadence":"astra";t.find(".palette").removeClass("selected"),jQuery(this).addClass("selected"),Cookies.set("ldDwPalette",a),m(s,"site-colors",a)})),jQuery(document).on("click",".design-wizard .reset-palette-button",(function(e){e.preventDefault();var t=jQuery(this).closest(".header").find(".palettes"),a=Cookies.get("ldDwTemplateId").includes("kadence_")?"kadence":"astra";t.find(".palette").removeClass("selected"),Cookies.remove("ldDwPalette"),m(a,"site-colors","default")})),jQuery(document).on("click",".next-button",(function(e){e.preventDefault();var t=window.location.href,a=new URLSearchParams(window.location.search),s=Cookies.get("ldDwTemplateId"),r=!1;if(!s||"undefined"===s)return alert("Please select a template first"),!1;var i=a.get("step");1===(i=i?parseInt(i):1)?(s.includes("astra_")&&Cookies.set("astra-site-color-scheme","light"),u(t,i,s,r)):4===i?(r=LearnDashDesignWizard.ajax_init_nonce,jQuery("#ld_dw_confirm").dialog({dialogClass:"wp-dialog",modal:!0,title:LearnDashDesignWizard.confirm_dialog.end_title,width:400,buttons:[{text:LearnDashDesignWizard.confirm_dialog.proceed,click:function(){u(t,i,s,r)}},{text:LearnDashDesignWizard.confirm_dialog.exit,click:function(){window.location.href=LearnDashDesignWizard.learndash_setup_url}}]})):u(t,i,s,r)})),jQuery(document).on("click",".back",(function(e){e.preventDefault(),history.back()})),jQuery(document).on("click",".exit",(function(e){e.preventDefault(),window.location.href=LearnDashDesignWizard.learndash_setup_url})),jQuery(document).on("click",".visit-site",(function(e){e.preventDefault(),jQuery('<a href="'+LearnDashDesignWizard.site_url+'" target="_blank"Visit Site</a>')[0].click()}))}));var o=0,n=4;function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",i=new URLSearchParams(window.location.search).get("step");e.length<1&&(e=LearnDashDesignWizard.ajaxurl);var c,p=["kadence_import_get_template_data","kadence_check_plugin_data","kadence_remove_past_import_data","kadence_import_install_plugins","kadence_import_demo_data","kadence_import_customizer_data","kadence_after_import_data"],u=Cookies.get("ldDwThemeTemplateId"),m=Cookies.get("ldDwLastBuildKadenceStep"),f=Cookies.get("ldDwTotalSteps"),h=Cookies.get("ldDwCurrentStepN"),w="";h=parseInt(h)+1,c=m?p.indexOf(m)+1:0;var _=p[c];if(_){switch(i=_,t.selected=u,t.builder="blocks",_){case"kadence_import_get_template_data":t.template_type="blocks",w="Get template data";break;case"check_plugin_data":t.selected="",t.builder="blocks",w="Check plugin data";break;case"kadence_import_demo_data":t.palette=Cookies.get("ldDwPalette"),t.font=Cookies.get("ldDwFont"),w="Import demo data";break;case"kadence_import_customizer_data":t.wp_customize="on",delete t.selected,delete t.builder,w="Import customizer data"}d({currentStepN:h,totalSteps:f,message:w}),jQuery.ajax({url:e,type:s,data:a({action:i,security:LearnDashDesignWizard.ajax_kadence_security_nonce},t),success:function(e){var t;switch(Cookies.set("ldDwCurrentStepN",h),Cookies.set("ldDwLastBuildKadenceStep",_),_){case"kadence_import_get_template_data":t=JSON.parse(e),Cookies.set("ldDwKadenceTemplateData",t);break;case"kadence_import_demo_data":"newAJAX"===e.status&&Cookies.set("ldDwLastBuildKadenceStep","kadence_import_install_plugins");break;case"kadence_after_import_data":return g(),void r()}l("",{},"POST")}}).error((function(){o<n?(o+=1,setTimeout((function(){l()}),5e3)):g()}))}else g()}function d(e){var t=e.currentStepN/e.totalSteps*100;t=(t=t>100?100:t).toFixed(0),jQuery(".progress .percentage .number").text(t+"%"),jQuery(".progress .bar progress").attr("value",t),""!==e.message&&jQuery(".progress .status .message").html(e.message)}function c(e,t){var a={};return Object.prototype.hasOwnProperty.call(LearnDashDesignWizard.fonts[e][t],"details")&&(a=LearnDashDesignWizard.fonts[e][t].details),a}function p(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return a.length>0?LearnDashDesignWizard.palettes[e][a][t]:LearnDashDesignWizard.palettes[e][t]}function u(e,t,a,s){var r={step:t+1,template:a,nonce:s};s||delete r.nonce;var i=new URLSearchParams(r),o=encodeURI(e+"&"+i.toString());window.location.href=o}function m(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=document.getElementById("ld-site-preview");if(s){var r,i,o,n,l={};switch(t){case"site-colors":"astra"===e?(r="colorPalette",i=p("astra",a,Cookies.get("astra-site-color-scheme")||"light")):"kadence"===e&&(o="color",n="default"!==a?Cookies.get("ldDwPalette"):"");break;case"site-typography":"astra"===e?(r="siteTypography",i=function(e,t){var a=e;t.id=a;return["font-family-h1","font-family-h2","font-family-h3","font-family-h4","font-family-h5","font-family-h6","font-weight-h1","font-weight-h2","font-weight-h3","font-weight-h4","font-weight-h5","font-weight-h6"].forEach((function(e){t[e]="inherit"})),["line-height-h1","line-height-h2","line-height-h3","line-height-h4","line-height-h5","line-height-h6","text-transform-h1","text-transform-h2","text-transform-h3","text-transform-h4","text-transform-h5","text-transform-h6"].forEach((function(e){t[e]=""})),t}(a,i=c("astra",a))):"kadence"===e&&(o="font",n="default"!==a?Cookies.get("ldDwFont"):"")}"astra"===e?r&&i&&s.contentWindow.postMessage({call:"starterTemplatePreviewDispatch",value:{param:r,data:i}},"*"):"kadence"===e&&(l[o]=n,s.contentWindow.postMessage(l,"*"))}}function f(e){jQuery.post(LearnDashDesignWizard.ajaxurl,{action:"astra-required-plugin-activate",_ajax_nonce:LearnDashDesignWizard.ajax_nonce,init:e.init},(function(){}))}function h(){var e=["ldDwCurrentStepN","ldDwTotalSteps","ldDwLastBuildAstraStep","ldDwLastBuildKadenceStep","astra-site-wpforms-path","astra-site-cartflows-path","astra-site-wxr-path","astra-site-widgets-data","astra-site-required-plugins"];arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&e.push.apply(e,["astra-site-color-scheme","ldDwTemplateId","ldDwThemeTemplateId","ldDwFont","ldDwPalette"]),e.forEach((function(e){Cookies.remove(e)}))}function g(){["ldDwLastBuildKadenceStep","ldDwPalette","ldDwFont"].forEach((function(e){Cookies.remove(e)}))}})();