!function(){"use strict";var $;$=jQuery,(new function(){let e=this;this.init=function(){$(document).on("ppress_updated_checkout",e.mountPayPalElement),$(document).on("ppress_update_checkout",e.unmountPayPalElement)},this.mountPayPalElement=function(){if(0===$("#ppress-paypal-button-element").length)return;const r="subscription"===ppressPayPalVars.intent?"createSubscription":"createOrder",t={onApprove:function(e,r){ppressCheckoutForm.add_spinner();var t=new FormData;return t.append("action","ppress_capture_paypal_order"),t.append("ppress_checkout_nonce",$("#ppress_checkout_nonce").val()),t.append("ppress_is_subscription","subscription"===ppressPayPalVars.intent?"true":"false"),void 0!==e.orderID&&t.append("paypal_order_id",e.orderID),void 0!==e.subscriptionID&&t.append("paypal_subscription_id",e.subscriptionID),fetch(pp_ajax_form.ajaxurl,{method:"POST",body:t}).then((function(e){return e.json()})).then((function(e){if(ppressCheckoutForm.is_var_defined(e.success)&&ppressCheckoutForm.is_var_defined(e.data)&&ppressCheckoutForm.is_var_defined(e.data.redirect_url))window.location.assign(e.data.redirect_url);else{var t=ppressCheckoutForm.is_var_defined(e.data.message)?e.data.message:ppressPayPalVars.defaultError;if(ppressCheckoutForm.createAlertMessage(t),ppressCheckoutForm.remove_spinner(),ppressCheckoutForm.is_var_defined(e.data.retry))return r.restart()}}))},onError:function(r){ppressCheckoutForm.createAlertMessage(r),ppressCheckoutForm.remove_spinner(),e.unmountPayPalElement(),e.mountPayPalElement()},onCancel:function(e){ppressCheckoutForm.remove_spinner()}};t.style=ppressPayPalVars.style,t[r]=e.createOrderSubscription,paypal.Buttons(t).render("#ppress-paypal-button-element")},this.createOrderSubscription=function(e,r){ppressCheckoutForm.add_spinner();let t=new FormData(document.getElementById("ppress_mb_checkout_form"));return t.append("action","ppress_paypal_process_checkout"),t.append("ppress_checkout_nonce",$("#ppress_checkout_nonce").val()),ppressCheckoutForm.removeAllAlerts(),fetch(pp_ajax_form.ajaxurl,{method:"POST",body:t}).then((function(e){return e.json()})).then((function(e){if(ppressCheckoutForm.is_var_defined(e.gateway_response))return ppressCheckoutForm.remove_spinner(),e.gateway_response;var r="";return"string"==typeof e.data?r=e.data:"string"==typeof e&&(r=e),new Promise((function(e,t){t(r)}))}))},this.unmountPayPalElement=function(){const e=$("#ppress-paypal-button-element");0!==e.length&&e.empty()}}).init()}();